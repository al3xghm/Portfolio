import React, { useState, useEffect, useRef } from 'react';
import styles from './Loader.module.scss';
import Image from 'next/image';

const Loader = () => {
  const [loading, setLoading] = useState(true);
  const [progress, setProgress] = useState(0);
  const loaderRef = useRef(null);

  useEffect(() => {
    // Timer pour désactiver le loader après 4 secondes
    const timer = setTimeout(() => {
      setLoading(false); // Désactiver le loader
      const loader = loaderRef.current;
      setTimeout(() => {
        loader.style.display = 'none';
        loader.remove();
      }, 2500);
    }, 2500);

    return () => clearTimeout(timer); // Nettoyer le timer
  }, []);

  useEffect(() => {
    // Mettre à jour la progression de 0 à 100% sur 4 secondes
    const interval = setInterval(() => {
      setProgress((prevProgress) => {
        if (prevProgress >= 100) {
          clearInterval(interval);
          return 100;
        }
        return prevProgress + 1;
      });
    }, 20); // 4000ms / 100 = 40ms pour chaque incrément

    return () => clearInterval(interval); // Nettoyer l'intervalle
  }, []);

  const handleAnimationEnd = () => {
    setLoaderAnimationComplete(true); // Marquer l'animation du loader comme terminée
  };

  return (
    <>
      <div id="loader" ref={loaderRef} className={`${styles.loader} ${loading ? styles.loading : styles.loaded}`} onAnimationEnd={handleAnimationEnd}>
        {/* <Image className={styles.logo} src="/baby.gif" alt="Baby" width={400} height={400} unoptimized /> */}
        <svg className={styles.logo} width="753" height="556" viewBox="0 0 753 556" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M341.597 3.207C331.731 9.34034 331.597 9.607 331.597 37.207C331.597 52.1403 330.797 67.0737 329.597 75.207C323.997 112.54 309.197 157.74 289.331 198.007L283.464 210.007L263.331 215.607C236.131 223.207 204.931 235.74 168.264 253.874C119.331 278.007 91.1974 298.54 57.5974 335.207C50.2641 343.207 39.3307 355.074 33.3307 361.474C20.9307 374.674 18.3974 380.007 20.7974 388.674C23.5974 398.94 34.3974 404.807 45.7307 402.007C47.8641 401.474 58.7974 391.874 72.9307 378.007C85.8641 365.34 100.931 351.607 106.397 347.474C122.664 335.34 153.597 316.407 175.597 305.207C205.864 290.007 243.197 273.607 244.531 275.074C245.464 275.874 208.931 329.874 183.331 365.607C143.464 421.34 117.464 454.54 95.5974 477.74C83.1974 490.674 60.2641 510.54 57.3307 510.54C55.4641 510.54 55.0641 506.674 55.5974 495.74C56.2641 480.54 41.3307 467.207 26.9307 470.007C16.2641 472.007 6.53073 482.674 2.13073 497.34C-1.33594 508.54 -0.535938 517.874 4.26406 525.874C5.9974 528.807 8.66406 533.74 10.1307 536.807C13.5974 544.274 22.2641 552.407 28.6641 554.274C36.3974 556.674 46.1307 556.14 52.6641 553.207C59.4641 550.14 75.9974 539.207 86.9307 530.54C98.5307 521.207 127.597 491.207 144.131 471.207C179.331 428.94 259.731 316.14 287.597 270.274L294.531 258.674L309.464 255.207C352.664 244.807 391.064 242.007 437.197 246.007L446.131 246.807L442.797 253.34C434.397 270.007 421.731 303.74 417.064 321.874C409.997 350.007 407.064 391.34 410.131 421.607C415.197 470.14 434.931 499.74 468.797 509.74C484.797 514.407 508.931 511.074 529.731 501.34C583.197 476.274 662.264 394.274 689.331 335.874C702.931 306.54 703.064 280.674 689.731 267.34C682.397 260.007 675.997 257.74 585.197 231.874C574.797 228.94 561.597 224.674 555.864 222.274C547.731 218.94 543.597 218.007 535.864 218.007C526.264 217.874 525.997 218.007 521.464 222.807C517.597 227.074 516.931 228.807 516.931 234.14C516.931 246.54 526.664 258.14 547.464 270.274C558.531 276.807 594.531 291.607 618.131 299.34C631.064 303.607 641.864 307.207 641.997 307.34C642.264 307.607 639.864 312.674 636.664 318.807C624.264 342.674 590.931 384.807 553.597 423.74C523.731 454.807 492.531 469.874 475.864 461.34C461.464 453.874 453.997 436.807 450.264 403.207C445.197 356.54 453.731 319.34 483.997 258.007C503.997 217.074 517.597 195.874 545.864 160.674C589.464 106.14 631.064 71.607 662.931 63.3403C677.197 59.607 696.264 65.0737 704.797 75.4737C707.197 78.2737 711.197 84.9403 713.864 90.2737C717.997 98.5403 718.797 101.74 719.331 111.074C720.397 132.407 715.731 144.674 702.931 153.74C692.264 161.34 684.531 170.274 682.531 176.94C675.997 198.807 692.531 208.807 715.864 196.94C722.664 193.607 736.131 177.34 741.731 165.74C753.331 141.874 756.264 92.6737 747.331 70.5403C739.197 50.5403 721.464 30.807 706.531 25.207C699.997 22.6737 696.264 22.2737 681.197 22.407C660.131 22.5403 650.931 24.407 635.197 31.8737C612.664 42.407 594.797 54.6737 571.064 75.7403C542.664 100.807 496.664 156.807 474.931 192.54C471.331 198.407 468.397 203.34 468.397 203.474C468.264 203.474 463.197 202.54 456.931 201.074C431.064 195.474 372.264 194.407 339.597 199.074C332.664 200.007 326.797 200.674 326.664 200.54C326.531 200.54 329.331 193.207 333.064 184.54C342.397 162.54 352.264 132.807 356.797 113.074L360.531 96.5403L365.597 106.54C378.664 132.274 414.131 176.54 430.131 186.807C434.931 189.874 437.597 190.54 443.864 190.54C457.064 190.54 463.597 184.807 463.597 173.34C463.597 165.474 461.997 162.274 452.131 151.607C414.264 110.407 392.264 75.7403 374.931 29.8737C370.797 18.807 366.797 8.407 365.864 6.807C362.264 -0.526331 350.531 -2.25966 341.597 3.207Z" fill="white" />
        </svg>

        <div className={styles.progress}>{progress}%</div>
      </div>
    </>
  );
};

export default Loader;
